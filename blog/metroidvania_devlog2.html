<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#000000"/><meta name="msapplication-TileColor" content="#2b5797"/><meta name="theme-color" content="#ffffff"/><meta name="google-site-verification" content="oliS-hJhDV0wCNFfVhfAC0igKcuVEDSj6XCaqtuSwQA"/><script src="/js/mode.js"></script><title>Metroidvania Devlog 2: State Machine Player Controller | How I Made A Game</title><script id="giscus-script" src="https://giscus.app/client.js" data-repo="levimcgomes/levimcgomes.github.io" data-repo-id="R_kgDOH_rqaA" data-category="Blog Comments" data-category-id="DIC_kwDOH_rqaM4CVNZX" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="top" data-theme="dark-dimmed" data-lang="en" crossorigin="anonymous" async=""></script><meta name="next-head-count" content="13"/><link rel="preload" href="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/css/cb4fb34b3c47d557.css" as="style"/><link rel="stylesheet" href="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/css/cb4fb34b3c47d557.css" data-n-g=""/><link rel="preload" href="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/css/28cea9dbbca02b72.css" as="style"/><link rel="stylesheet" href="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/css/28cea9dbbca02b72.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/webpack-74ef5a84c939c88d.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/main-18053c3f67c4d467.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/pages/_app-4862d28c0e85fdc0.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/175675d1-370b5e3106085c09.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/b5f2ed29-b0b5179426d9fdcf.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/pages/blog/%5Bslug%5D-ecd2c457fac278ec.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/3w9kOThaLPqoSOIVtuwsQ/_buildManifest.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/3w9kOThaLPqoSOIVtuwsQ/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4XQ38SS8N1"></script><script src="/js/gtag.js"></script><div class="header-container"><h2 href="/">How I Made A Game</h2><div><a href="/#about">About</a><a href="/archive">All Posts</a><a href="/">Home</a><button class="theme-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="#FFFFFF" style="cursor:pointer;transform:rotate(40deg)"><mask id="myMask2"><rect x="0" y="0" width="100%" height="100%" fill="white"></rect><circle style="cx:12px;cy:4px" r="9" fill="black"></circle></mask><circle cx="12" cy="12" style="r:9px" fill="white" mask="url(#myMask2)"></circle><g stroke="white" style="opacity:0"><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></g></svg></button></div></div><main class="page"><div align="right"><a class="btn-back"><span>Go Back</span></a></div><div class="post-page"><h1 class="post-title">Metroidvania Devlog 2: State Machine Player Controller</h1><img class="post-full-image" src="../images/posts/metroidvania/devlog2_cover.gif" alt=""/><div class="post-date">20/1/2023</div><div class="post-tags"><div class="post-tag">metroidvania</div><div class="post-tag">devlog</div><div class="post-tag">Unity</div><div class="post-tag">Player Controller</div></div><div class="post-body"><div><p>Being quite tired of dealing with networking and multiplayer, I decided to start implementing the actual game. So I set out in search of something to serve as a starting point, and I found this <strong>amazing</strong> tutorial by Bardent: <a href="https://youtube.com/playlist?list=PLy78FINcVmjA0zDBhLuLNL1Jo6xNMMq-W">see the full playlist</a> (note that the relevant videos start at part 20). So, while the videos do an excellent job at explaining everything, I might as well explain it myself.</p>
<blockquote>
<p><strong>Disclaimer:</strong> I'm not in any way trying to steal Bardent's content. Instead, I'm trying to explain how I started making the player controller.</p>
</blockquote>
<h2>The state machine</h2>
<p>All the geniality of this player controller comes from its core idea: a state machine. For those of you that don't know, I'll try my best to explain what a state machine is.</p>
<p>Think of a collection of data, and a way to perform an action acknowledging that data (quite similar to what a class is in OOP). That is a state. If you have a collection of different states, which transition between them, you have a state machine.</p>
<p>This particular system has five main components:</p>
<ul>
<li>the <code>Player</code> script, which has various functionalities</li>
<li>the <code>PlayerStateMachine</code> script, which updates states, and deals with transitions</li>
<li>the <code>PlayerState</code> abstract class, which serves as a base for other states</li>
<li>the <code>InputHandler</code> script, which takes care of responding and managing input</li>
<li>the <code>PlayerData</code> scriptable object, which holds various parameters used by the states.</li>
</ul>
<h3>The <code>PlayerState</code> class</h3>
<pre class="hljs"><code><table><tbody><tr><td class="line-number">1</td><td class="code-line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PlayerState</span> {</td></tr><tr><td class="line-number">2</td><td class="code-line">   <span class="hljs-keyword">protected</span> Player player;</td></tr><tr><td class="line-number">3</td><td class="code-line">   <span class="hljs-keyword">protected</span> PlayerStateMachine stateMachine;</td></tr><tr><td class="line-number">4</td><td class="code-line">   <span class="hljs-keyword">protected</span> PlayerData playerData;</td></tr><tr><td class="line-number">5</td><td class="code-line"></td></tr><tr><td class="line-number">6</td><td class="code-line">   <span class="hljs-keyword">protected</span> <span class="hljs-built_in">bool</span> isAnimationFinished;</td></tr><tr><td class="line-number">7</td><td class="code-line">   <span class="hljs-keyword">protected</span> <span class="hljs-built_in">bool</span> isExitingState;</td></tr><tr><td class="line-number">8</td><td class="code-line">   <span class="hljs-keyword">protected</span> <span class="hljs-built_in">float</span> startTime;</td></tr><tr><td class="line-number">9</td><td class="code-line">   <span class="hljs-keyword">protected</span> <span class="hljs-built_in">string</span> animBoolName;</td></tr><tr><td class="line-number">10</td><td class="code-line"></td></tr><tr><td class="line-number">11</td><td class="code-line">   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PlayerState</span>(<span class="hljs-params">Player player, PlayerStateMachine stateMachine, PlayerData playerData, <span class="hljs-built_in">string</span> animBoolName</span>)</span> { }</td></tr><tr><td class="line-number">12</td><td class="code-line"></td></tr><tr><td class="line-number">13</td><td class="code-line">   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Enter</span>()</span> { }</td></tr><tr><td class="line-number">14</td><td class="code-line">   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Exit</span>()</span> { }</td></tr><tr><td class="line-number">15</td><td class="code-line">   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogicUpdate</span>()</span> { }</td></tr><tr><td class="line-number">16</td><td class="code-line">   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PhysicsUpdate</span>()</span> { };</td></tr><tr><td class="line-number">17</td><td class="code-line">   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DoChecks</span>()</span> { }</td></tr><tr><td class="line-number">18</td><td class="code-line">   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AnimationTrigger</span>()</span> { }</td></tr><tr><td class="line-number">19</td><td class="code-line">   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AnimationFinishTrigger</span>()</span> { }</td></tr><tr><td class="line-number">20</td><td class="code-line">}</td></tr></tbody></table></code></pre>
<p>For the sake of brevity, I omitted most of the implementations. However, looking at the script it's easy to see what it does. Lines 2-4 hold references to useful components; lines 6-9 hold state inner data; line 11 is a default constructor; lines 13-19 have various functions. <code>Enter()</code>, <code>LogicUpdate()</code>, <code>PhysicsUpdate()</code> and <code>Exit()</code> are 'lifecycle' functions, and their names are pretty self-explanatory. <code>DoChecks()</code> contains various checks that a state needs to do at some points in the code. <code>AnimationTrigger()</code> and <code>AnimationFinishTrigger()</code> are used to hook into animation events, which is needed for some states.</p>
<h3>The <code>PlayerStateMachine</code> component</h3>
<p>This one is pretty simple: first, it's initialized with a default state. Then, it has only another function: <code>ChangeState()</code>, which calls <code>Exit()</code> on the current state, changes it to the new state, and then calls <code>Enter()</code> on it.</p>
<h3>The <code>Player</code> component</h3>
<p>At the start of this post, I stated that Bardent's player controller was amazing (and it is), but if I had to choose something I don't like about it, it'd be the <code>Player</code> script. It's a mishmash of random functionality:</p>
<ul>
<li>it holds an exhaustive list of all the <code>PlayerState</code>'s, so that states can change to other states,</li>
<li>it has functions to do common tasks like set the player's velocity,</li>
<li>it has function to check certain conditions, like being grounded,</li>
<li>and it has some more random functions.</li>
</ul>
<p>However, it does work. Just not cleanly.</p>
<h3>The structure of the State Machine</h3>
<figure>
                <img src = "../images/posts/metroidvania/SMD.png" alt = "  Image by Bardent" style = "width:100%" />
                <figcaption><strong>Diagram of the state machine</strong>  Image by Bardent</figcaption>
            </figure > <p>The image is pretty obvious, but basically there is a set of states all hard-wired to transition to some other states (which I intend to change).</p>
<h2>Conclusion</h2>
<p>All things considered, this player controller is very good, but there is some room for improvement. I intend to make this system more generalist, modular and overall cleaner. However, for the next post we'll take a detour from coding. Because, in the meanwhile, I've been writing some <strong>lore</strong>. So the next post will be about my creative process: how I come up with ideas, and how I perfect them. I hope I'll have you with me again! Goodbye 'til then.</p>
</div></div></div><div class="giscus"></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Metroidvania Devlog 2: State Machine Player Controller","date":"20/1/2023","cover_image":"images/posts/metroidvania/devlog2_cover.gif","tags":["metroidvania","devlog","Unity","Player Controller"],"excerpt":"In this post, we delve deep into the implementation of a Player Controller"},"slug":"metroidvania_devlog2","content":"\nBeing quite tired of dealing with networking and multiplayer, I decided to start implementing the actual game. So I set out in search of something to serve as a starting point, and I found this **amazing** tutorial by Bardent: [see the full playlist](https://youtube.com/playlist?list=PLy78FINcVmjA0zDBhLuLNL1Jo6xNMMq-W) (note that the relevant videos start at part 20). So, while the videos do an excellent job at explaining everything, I might as well explain it myself.\n\u003e**Disclaimer:** I'm not in any way trying to steal Bardent's content. Instead, I'm trying to explain how I started making the player controller.\n\n## The state machine\nAll the geniality of this player controller comes from its core idea: a state machine. For those of you that don't know, I'll try my best to explain what a state machine is.\n\nThink of a collection of data, and a way to perform an action acknowledging that data (quite similar to what a class is in OOP). That is a state. If you have a collection of different states, which transition between them, you have a state machine.\n\nThis particular system has five main components:\n - the ``Player`` script, which has various functionalities\n - the ``PlayerStateMachine`` script, which updates states, and deals with transitions\n - the ``PlayerState`` abstract class, which serves as a base for other states\n - the ``InputHandler`` script, which takes care of responding and managing input\n - the ``PlayerData`` scriptable object, which holds various parameters used by the states.\n\n ### The ``PlayerState`` class\n ```cs showLineNumbers\n public class PlayerState {\n    protected Player player;\n    protected PlayerStateMachine stateMachine;\n    protected PlayerData playerData;\n\n    protected bool isAnimationFinished;\n    protected bool isExitingState;\n    protected float startTime;\n    protected string animBoolName;\n\n    public PlayerState(Player player, PlayerStateMachine stateMachine, PlayerData playerData, string animBoolName) { }\n\n    public virtual void Enter() { }\n    public virtual void Exit() { }\n    public virtual void LogicUpdate() { }\n    public virtual void PhysicsUpdate() { };\n    public virtual void DoChecks() { }\n    public virtual void AnimationTrigger() { }\n    public virtual void AnimationFinishTrigger() { }\n}\n ```\n\n For the sake of brevity, I omitted most of the implementations. However, looking at the script it's easy to see what it does. Lines 2-4 hold references to useful components; lines 6-9 hold state inner data; line 11 is a default constructor; lines 13-19 have various functions. ``Enter()``, ``LogicUpdate()``, ``PhysicsUpdate()`` and ``Exit()`` are 'lifecycle' functions, and their names are pretty self-explanatory. ``DoChecks()`` contains various checks that a state needs to do at some points in the code. ``AnimationTrigger()`` and ``AnimationFinishTrigger()`` are used to hook into animation events, which is needed for some states.\n\n ### The ``PlayerStateMachine`` component\n This one is pretty simple: first, it's initialized with a default state. Then, it has only another function: ``ChangeState()``, which calls ``Exit()`` on the current state, changes it to the new state, and then calls ``Enter()`` on it.\n\n ### The ``Player`` component\n At the start of this post, I stated that Bardent's player controller was amazing (and it is), but if I had to choose something I don't like about it, it'd be the ``Player`` script. It's a mishmash of random functionality: \n - it holds an exhaustive list of all the ``PlayerState``'s, so that states can change to other states,\n - it has functions to do common tasks like set the player's velocity,\n - it has function to check certain conditions, like being grounded,\n - and it has some more random functions.\n \n However, it does work. Just not cleanly.\n\n ### The structure of the State Machine\n \u0026\u0026\u0026img[images/posts/metroidvania/SMD.png](Diagram of the state machine)  Image by Bardent\n \u0026\u0026\u0026\n\n The image is pretty obvious, but basically there is a set of states all hard-wired to transition to some other states (which I intend to change).\n\n ## Conclusion\n All things considered, this player controller is very good, but there is some room for improvement. I intend to make this system more generalist, modular and overall cleaner. However, for the next post we'll take a detour from coding. Because, in the meanwhile, I've been writing some **lore**. So the next post will be about my creative process: how I come up with ideas, and how I perfect them. I hope I'll have you with me again! Goodbye 'til then."},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"metroidvania_devlog2"},"buildId":"3w9kOThaLPqoSOIVtuwsQ","assetPrefix":"https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>