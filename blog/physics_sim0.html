<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#000000"/><meta name="msapplication-TileColor" content="#2b5797"/><meta name="theme-color" content="#ffffff"/><meta name="google-site-verification" content="oliS-hJhDV0wCNFfVhfAC0igKcuVEDSj6XCaqtuSwQA"/><script src="/js/mode.js"></script><title>Setting up the project: Physics Engine Tutorial 0 | How I Made A Game</title><meta name="description" content="We&#x27;ll start working on a physics engine to explore the wonderfull world of dynamics and mechanics!"/><script id="giscus-script" src="https://giscus.app/client.js" data-repo="levimcgomes/levimcgomes.github.io" data-repo-id="R_kgDOH_rqaA" data-category="Blog Comments" data-category-id="DIC_kwDOH_rqaM4CVNZX" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="top" data-theme="dark-dimmed" data-lang="en" crossorigin="anonymous" async=""></script><meta name="next-head-count" content="14"/><link rel="preload" href="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/css/3f14950d30926277.css" as="style"/><link rel="stylesheet" href="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/css/3f14950d30926277.css" data-n-g=""/><link rel="preload" href="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/css/28cea9dbbca02b72.css" as="style"/><link rel="stylesheet" href="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/css/28cea9dbbca02b72.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/webpack-74ef5a84c939c88d.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/main-18053c3f67c4d467.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/pages/_app-4862d28c0e85fdc0.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/175675d1-370b5e3106085c09.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/b5f2ed29-b0b5179426d9fdcf.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/pages/blog/%5Bslug%5D-c43d00c2c6b941b0.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/38p1H73p411ZP_-sQioo4/_buildManifest.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/38p1H73p411ZP_-sQioo4/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4XQ38SS8N1"></script><script src="/js/gtag.js"></script><div class="header-container"><h2 href="/">How I Made A Game</h2><div><a href="/#about">About</a><a href="/archive">All Posts</a><a href="/">Home</a><button class="theme-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="#FFFFFF" style="cursor:pointer;transform:rotate(40deg)"><mask id="myMask2"><rect x="0" y="0" width="100%" height="100%" fill="white"></rect><circle style="cx:12px;cy:4px" r="9" fill="black"></circle></mask><circle cx="12" cy="12" style="r:9px" fill="white" mask="url(#myMask2)"></circle><g stroke="white" style="opacity:0"><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></g></svg></button></div></div><main class="page"><div align="right"><a class="btn-back"><span>Go Back</span></a></div><div class="post-page"><h1 class="post-title">Setting up the project: Physics Engine Tutorial 0</h1><img class="post-full-image" src="../images/posts/physics/sim0_cover.png" alt=""/><div class="post-date">31/3/2023</div><div class="post-tags"><div class="post-tag">physics</div><div class="post-tag">simulation</div><div class="post-tag">tutorial</div></div><div class="post-body"><div><p>For the last few months, I've been writing almost exclusively about my game. I'm still working on it, and I'll be posting more devlogs, but I also want to write about other stuff. So this will be the first in a series of tutorials about making a physics engine from scratch with C#. Why? Because I like physics. So without further ado, let's get started.</p>
<h2>Creating the project and making the visualisation</h2>
<p>Before we start making a physics simulation, we need some way to view what the simulation is computing. For the sake of simplicity, I'll use <a href="https://www.raylib.com/index.html">Raylib</a>, and it's <a href="https://github.com/ChrisDill/Raylib-cs">C# bindings</a>. It's very easy to pick up (I hadn't ever used it, but I found my way around it in less than a day) and its simplicity will allow us to focus oon the physics. Furthermore, I'll be using Visual Studio to do the coding, so the process I'll describe for installing the library will be for Visual Studio.</p>
<p>First, I created a new C# project. To get a clean slate, I chose a Console App. I named the solution PhysicsSim and the project PhysicsSimTester, but you can choose other names. Then I added another project to the solution, specifically a class library, named PhysicsSim. The class library will be the actual physics simulator, while the console app will only use it, in order to allow us to test our physics code. From now on, I'll refer to the class library as the <em>'library'</em> and to the console app as the <em>'tester'</em> We'll be starting by making a particle based engine, and then upgrade it to handle rigidbodies. So let's add a new class called <code>Particle</code> to the library. For now, I'll leave it blank. We'll come back to it later, I only added it this soon so we can prepare a skeleton for the testing code. That way, I can get it out of the way early, and then focus on implementing the physics.</p>
<p>Now we need to install the <code>raylib-cs</code> NuGet package. If you don't know how to install a NuGet package, search it up. Also, we'll have to add a reference to the library in the tester. With this out of the way, we can start coding. Let's open up the autogenerated Program.cs in the tester. At the top we'll add references to Raylib, the physics library and to the tester namespace</p>
<pre class="hljs"><code><table><tbody><tr><td class="line-number">1</td><td class="code-line"><span class="hljs-keyword">using</span> Raylib_cs;</td></tr><tr><td class="line-number">2</td><td class="code-line"><span class="hljs-keyword">using</span> PhysicsSim;</td></tr><tr><td class="line-number">3</td><td class="code-line"><span class="hljs-keyword">using</span> PhysicsSimTester;</td></tr></tbody></table></code></pre>
<p>Inside the <code>Main</code> function, we'll write the following code:</p>
<pre class="hljs"><code><table><tbody><tr><td class="line-number">1</td><td class="code-line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>) </td></tr><tr><td class="line-number">2</td><td class="code-line">        <span class="hljs-comment">// Initialize Raylib</span></td></tr><tr><td class="line-number">3</td><td class="code-line">        Raylib.<span class="hljs-title">InitWindow</span>(<span class="hljs-params"><span class="hljs-number">800</span>, <span class="hljs-number">800</span>, <span class="hljs-string">&quot;Physics Sim&quot;</span></span>)</span>;</td></tr><tr><td class="line-number">4</td><td class="code-line">        Raylib.SetTraceLogLevel(TraceLogLevel.LOG_ALL);</td></tr><tr><td class="line-number">5</td><td class="code-line">        Raylib.SetTargetFPS(<span class="hljs-number">200</span>);</td></tr><tr><td class="line-number">6</td><td class="code-line">        </td></tr><tr><td class="line-number">7</td><td class="code-line">        <span class="hljs-comment">// Core loop</span></td></tr><tr><td class="line-number">8</td><td class="code-line">        <span class="hljs-keyword">while</span>(!Raylib.WindowShouldClose()) {</td></tr><tr><td class="line-number">9</td><td class="code-line">            Raylib.BeginDrawing();</td></tr><tr><td class="line-number">10</td><td class="code-line">            Raylib.ClearBackground(Color.BLACK);</td></tr><tr><td class="line-number">11</td><td class="code-line">            Raylib.DrawCircle(<span class="hljs-number">400</span>, <span class="hljs-number">400</span>, <span class="hljs-number">100</span>, Color.WHITE);</td></tr><tr><td class="line-number">12</td><td class="code-line">            Raylib.EndDrawing();</td></tr><tr><td class="line-number">13</td><td class="code-line">        }</td></tr><tr><td class="line-number">14</td><td class="code-line"></td></tr><tr><td class="line-number">15</td><td class="code-line">        Raylib.CloseWindow();</td></tr><tr><td class="line-number">16</td><td class="code-line">    }</td></tr></tbody></table></code></pre>
<p>First, we open a 800 by 800 window, tell Raylib to log everything and set the framerate to 200. Then we loop until Raylib tells us we should close the window. Every frame, we prepare for drawing, clear the canvas, draw a circle and send out the new frame. If you run this code, you should get something like fig. 1.</p>
<figure>
                <img src = "../images/posts/physics/raylib_helloworld.png" alt = " A simple Raylib program." style = "width:100%" />
                <figcaption><strong>Figure 1</strong> A simple Raylib program.</figcaption>
            </figure > <p>Next we'll add a <code>Visualisation</code> class. This will be what actually draws things to the screen in the final program.</p>
<pre class="hljs"><code><table><tbody><tr><td class="line-number">1</td><td class="code-line"><span class="hljs-keyword">using</span> PhysicsSim;</td></tr><tr><td class="line-number">2</td><td class="code-line"><span class="hljs-keyword">using</span> Raylib_cs;</td></tr><tr><td class="line-number">3</td><td class="code-line"></td></tr><tr><td class="line-number">4</td><td class="code-line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">PhysicsSimTester</span></td></tr><tr><td class="line-number">5</td><td class="code-line">{</td></tr><tr><td class="line-number">6</td><td class="code-line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Visualization</span></td></tr><tr><td class="line-number">7</td><td class="code-line">    {</td></tr><tr><td class="line-number">8</td><td class="code-line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> Res;</td></tr><tr><td class="line-number">9</td><td class="code-line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> TextUnits { <span class="hljs-keyword">get</span> =&gt; Res / <span class="hljs-number">100</span>; }</td></tr><tr><td class="line-number">10</td><td class="code-line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Font font;</td></tr><tr><td class="line-number">11</td><td class="code-line"></td></tr><tr><td class="line-number">12</td><td class="code-line">        <span class="hljs-comment">// Variables used for the debug interface</span></td></tr><tr><td class="line-number">13</td><td class="code-line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">struct</span> SmoothDebugFloat {</td></tr><tr><td class="line-number">14</td><td class="code-line">            <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> cacheMax = <span class="hljs-number">64</span>;</td></tr><tr><td class="line-number">15</td><td class="code-line">            <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> currentIndex;</td></tr><tr><td class="line-number">16</td><td class="code-line">            <span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span>[] cachedValues;</td></tr><tr><td class="line-number">17</td><td class="code-line">            <span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span> sum;</td></tr><tr><td class="line-number">18</td><td class="code-line">            <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> AverageValue { <span class="hljs-keyword">get</span> =&gt; sum / cacheMax; }</td></tr><tr><td class="line-number">19</td><td class="code-line"></td></tr><tr><td class="line-number">20</td><td class="code-line">            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SmoothDebugFloat</span>()</span> {</td></tr><tr><td class="line-number">21</td><td class="code-line">                currentIndex = <span class="hljs-number">0</span>;</td></tr><tr><td class="line-number">22</td><td class="code-line">                cachedValues = <span class="hljs-keyword">new</span> <span class="hljs-built_in">float</span>[cacheMax];</td></tr><tr><td class="line-number">23</td><td class="code-line">                sum = <span class="hljs-number">0</span>;</td></tr><tr><td class="line-number">24</td><td class="code-line">            }</td></tr><tr><td class="line-number">25</td><td class="code-line">            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">FeedValue</span>(<span class="hljs-params"><span class="hljs-built_in">float</span> <span class="hljs-keyword">value</span></span>)</span> {</td></tr><tr><td class="line-number">26</td><td class="code-line">                sum -= cachedValues[currentIndex];</td></tr><tr><td class="line-number">27</td><td class="code-line">                sum += <span class="hljs-keyword">value</span>;</td></tr><tr><td class="line-number">28</td><td class="code-line">                cachedValues[currentIndex] = <span class="hljs-keyword">value</span>;</td></tr><tr><td class="line-number">29</td><td class="code-line">                currentIndex = (currentIndex + <span class="hljs-number">1</span>) % cacheMax;</td></tr><tr><td class="line-number">30</td><td class="code-line">            }</td></tr><tr><td class="line-number">31</td><td class="code-line">        }</td></tr><tr><td class="line-number">32</td><td class="code-line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SmoothDebugFloat deltaTime;</td></tr><tr><td class="line-number">33</td><td class="code-line"></td></tr><tr><td class="line-number">34</td><td class="code-line">        </td></tr><tr><td class="line-number">35</td><td class="code-line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Init</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> res</span>)</span> {</td></tr><tr><td class="line-number">36</td><td class="code-line">            <span class="hljs-comment">// Set the resolution</span></td></tr><tr><td class="line-number">37</td><td class="code-line">            Res = res;</td></tr><tr><td class="line-number">38</td><td class="code-line"></td></tr><tr><td class="line-number">39</td><td class="code-line">            <span class="hljs-comment">// Initialize Raylib</span></td></tr><tr><td class="line-number">40</td><td class="code-line">            Raylib.InitWindow(Res, Res, <span class="hljs-string">&quot;Physics Sim&quot;</span>);</td></tr><tr><td class="line-number">41</td><td class="code-line">            Raylib.SetTraceLogLevel(TraceLogLevel.LOG_ALL);</td></tr><tr><td class="line-number">42</td><td class="code-line">            Raylib.SetTargetFPS(<span class="hljs-number">200</span>);</td></tr><tr><td class="line-number">43</td><td class="code-line">            <span class="hljs-comment">// Load a better font</span></td></tr><tr><td class="line-number">44</td><td class="code-line">            font = Raylib.LoadFontEx(<span class="hljs-string">&quot;times.ttf&quot;</span>, <span class="hljs-number">256</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">1024</span>);</td></tr><tr><td class="line-number">45</td><td class="code-line"></td></tr><tr><td class="line-number">46</td><td class="code-line">            deltaTime = <span class="hljs-keyword">new</span> SmoothDebugFloat();</td></tr><tr><td class="line-number">47</td><td class="code-line">        }</td></tr><tr><td class="line-number">48</td><td class="code-line"></td></tr><tr><td class="line-number">49</td><td class="code-line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DrawAll</span>(<span class="hljs-params"><span class="hljs-keyword">params</span> Particle[] objects</span>)</span> {</td></tr><tr><td class="line-number">50</td><td class="code-line">            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> obj <span class="hljs-keyword">in</span> objects) {</td></tr><tr><td class="line-number">51</td><td class="code-line">                Draw(obj);</td></tr><tr><td class="line-number">52</td><td class="code-line">            }</td></tr><tr><td class="line-number">53</td><td class="code-line">        }</td></tr><tr><td class="line-number">54</td><td class="code-line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span>(<span class="hljs-params">Particle obj</span>)</span> {</td></tr><tr><td class="line-number">55</td><td class="code-line">            </td></tr><tr><td class="line-number">56</td><td class="code-line">        }</td></tr><tr><td class="line-number">57</td><td class="code-line"></td></tr><tr><td class="line-number">58</td><td class="code-line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DrawDebugInterface</span>(<span class="hljs-params"><span class="hljs-built_in">float</span> dt</span>)</span> {</td></tr><tr><td class="line-number">59</td><td class="code-line">            <span class="hljs-comment">// Feed the delta time to the corresponding smooth value</span></td></tr><tr><td class="line-number">60</td><td class="code-line">            deltaTime.FeedValue(dt);</td></tr><tr><td class="line-number">61</td><td class="code-line"></td></tr><tr><td class="line-number">62</td><td class="code-line">            <span class="hljs-comment">// Write info to the screen</span></td></tr><tr><td class="line-number">63</td><td class="code-line">            DrawDebugLine(<span class="hljs-string">$&quot;<span class="hljs-subst">{objects.Length}</span> objects @ <span class="hljs-subst">{(<span class="hljs-number">1</span> / deltaTime.AverageValue).ToString(<span class="hljs-string">&quot;F0&quot;</span>)}</span> FPS&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);</td></tr><tr><td class="line-number">64</td><td class="code-line">            DrawDebugLine(<span class="hljs-string">$&quot;<span class="hljs-subst">{(dt*<span class="hljs-number">1000</span>).ToString(<span class="hljs-string">&quot;F4&quot;</span>)}</span>Δt (in ms)&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>);</td></tr><tr><td class="line-number">65</td><td class="code-line">        }</td></tr><tr><td class="line-number">66</td><td class="code-line">        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DrawDebugLine</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> line, <span class="hljs-built_in">float</span> x, <span class="hljs-built_in">float</span> y</span>)</span> {</td></tr><tr><td class="line-number">67</td><td class="code-line">            Raylib.DrawTextEx(font, line, <span class="hljs-keyword">new</span> System.Numerics.Vector2(x * ScreenUnit, y * ScreenUnit),</td></tr><tr><td class="line-number">68</td><td class="code-line">                    (<span class="hljs-built_in">int</span>)(<span class="hljs-number">2.6</span> * ScreenUnit), (<span class="hljs-built_in">int</span>)(ScreenUnit / <span class="hljs-number">3</span>), Color.RAYWHITE);</td></tr><tr><td class="line-number">69</td><td class="code-line">        }</td></tr><tr><td class="line-number">70</td><td class="code-line">        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DrawDebugLine</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> line, <span class="hljs-built_in">float</span> x, <span class="hljs-built_in">float</span> y, Color color</span>)</span> {</td></tr><tr><td class="line-number">71</td><td class="code-line">            Raylib.DrawTextEx(font, line, <span class="hljs-keyword">new</span> System.Numerics.Vector2(x * ScreenUnit, y * ScreenUnit),</td></tr><tr><td class="line-number">72</td><td class="code-line">                    (<span class="hljs-built_in">int</span>)(<span class="hljs-number">2.6</span> * ScreenUnit), (<span class="hljs-built_in">int</span>)(ScreenUnit / <span class="hljs-number">3</span>), color);</td></tr><tr><td class="line-number">73</td><td class="code-line">        }</td></tr><tr><td class="line-number">74</td><td class="code-line">    }</td></tr><tr><td class="line-number">75</td><td class="code-line">}</td></tr></tbody></table></code></pre>
<p>Thats's a lot, so let's break it down. Firstly, we declare a few variables for convenience. Next we declare the <code>SmoothDebugFloat</code> struct. This struct holds a list ov previous values of <em>something</em> and computes their average. This way, values that change very fast are smoothed. As we need to write more and more debug info, this will become very usefull. For now, we're using it only for delta time. Then we initialize the visualization. We set the resolution, open a window, set the log level (what kind of info Raylib should output to the console), set the desired FPS, load a font ant initialize our delta time. Next, the <code>DrawAll</code> function receives a list of particles and <code>Draw</code>s each one of them. For now, we don't actually ddraw anything. Finally, we have a function to draw some debug info to the screen.</p>
<p>For the font loading to work, it is necessary to have a font file in the same folder as the program. To get the file, if you're on Windows, you can go to <code>C:\Windows\Fonts</code> and search for the font family you want (for instance, I chose Times New Roman). Then open it and copy the specific font (I chose the normal one, but you could use bold or italic). Open your project's root folder and navigate to the folder where the <code>.exe</code> file is, and paste the font file.</p>
<p>Now it's only a matter of calling these functions from <code>Main</code>.</p>
<pre class="hljs"><code><table><tbody><tr><td class="line-number">1</td><td class="code-line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>) </td></tr><tr><td class="line-number">2</td><td class="code-line">        <span class="hljs-comment">// Init the visualization</span></td></tr><tr><td class="line-number">3</td><td class="code-line">        Visualization.<span class="hljs-title">Init</span>(<span class="hljs-params"><span class="hljs-number">800</span></span>)</span>;</td></tr><tr><td class="line-number">4</td><td class="code-line">        </td></tr><tr><td class="line-number">5</td><td class="code-line">        <span class="hljs-comment">// Core loop</span></td></tr><tr><td class="line-number">6</td><td class="code-line">        <span class="hljs-keyword">while</span>(!Raylib.WindowShouldClose()) {</td></tr><tr><td class="line-number">7</td><td class="code-line">            Raylib.BeginDrawing();</td></tr><tr><td class="line-number">8</td><td class="code-line">            Raylib.ClearBackground(Color.BLACK);</td></tr><tr><td class="line-number">9</td><td class="code-line">            Visualization.DrawAll();</td></tr><tr><td class="line-number">10</td><td class="code-line">            Visualization.DrawDebugInterface(Raylib.GetFrameTime());</td></tr><tr><td class="line-number">11</td><td class="code-line">            Raylib.EndDrawing();</td></tr><tr><td class="line-number">12</td><td class="code-line">        }</td></tr><tr><td class="line-number">13</td><td class="code-line"></td></tr><tr><td class="line-number">14</td><td class="code-line">        Raylib.CloseWindow();</td></tr><tr><td class="line-number">15</td><td class="code-line">    }</td></tr></tbody></table></code></pre>
<p>And this concludes what we could call the frontend of this app. Before we start implementing the simulation itself, it's necessary to review a lot of maths and physics. So, not to make this post enormous, I'll postpone that for the next post, making this one a shorter one. I'm really excited for this project, and I hopefully so are you. Until the next time, have some fun toying around with Raylib! As a side note, I'd advise you to study some <a href="https://youtube.com/playlist?list=PLZHQObOWTQDMsr9K-rj53DwVRMYO3t5Yr">calculus</a> and <a href="https://youtube.com/playlist?list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab">linear algebra</a> while you're waiting for the next post, especially if you don't know much about these topics, because they'll be very important. And finally, you can find the source code for this project (although at a later stage) on <a href="https://github.com/levimcgomes/PhysicsSim">GitHub</a>.</p>
</div></div></div><div class="newsletter-post"><form action="https://levimcgomes.pythonanywhere.com/newsletter_signup" method="POST">Subscribe to my newsletter to get notified about new posts!<div class="newsletter-form"><input type="email" name="email_address" placeholder="email address"/><input type="hidden" name="signup_page" value="https://levimcgomes.github.io/blog/physics_sim0"/><input type="submit" class="btn" value="Sign up"/></div></form></div><div class="giscus"></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Setting up the project: Physics Engine Tutorial 0","date":"31/3/2023","cover_image":"images/posts/physics/sim0_cover.png","tags":["physics","simulation","tutorial"],"excerpt":"We'll start working on a physics engine to explore the wonderfull world of dynamics and mechanics!"},"slug":"physics_sim0","content":"\nFor the last few months, I've been writing almost exclusively about my game. I'm still working on it, and I'll be posting more devlogs, but I also want to write about other stuff. So this will be the first in a series of tutorials about making a physics engine from scratch with C#. Why? Because I like physics. So without further ado, let's get started.\n\n## Creating the project and making the visualisation\nBefore we start making a physics simulation, we need some way to view what the simulation is computing. For the sake of simplicity, I'll use [Raylib](https://www.raylib.com/index.html), and it's [C# bindings](https://github.com/ChrisDill/Raylib-cs). It's very easy to pick up (I hadn't ever used it, but I found my way around it in less than a day) and its simplicity will allow us to focus oon the physics. Furthermore, I'll be using Visual Studio to do the coding, so the process I'll describe for installing the library will be for Visual Studio.\n\nFirst, I created a new C# project. To get a clean slate, I chose a Console App. I named the solution PhysicsSim and the project PhysicsSimTester, but you can choose other names. Then I added another project to the solution, specifically a class library, named PhysicsSim. The class library will be the actual physics simulator, while the console app will only use it, in order to allow us to test our physics code. From now on, I'll refer to the class library as the *'library'* and to the console app as the *'tester'* We'll be starting by making a particle based engine, and then upgrade it to handle rigidbodies. So let's add a new class called ``Particle`` to the library. For now, I'll leave it blank. We'll come back to it later, I only added it this soon so we can prepare a skeleton for the testing code. That way, I can get it out of the way early, and then focus on implementing the physics.\n\nNow we need to install the ``raylib-cs`` NuGet package. If you don't know how to install a NuGet package, search it up. Also, we'll have to add a reference to the library in the tester. With this out of the way, we can start coding. Let's open up the autogenerated Program.cs in the tester. At the top we'll add references to Raylib, the physics library and to the tester namespace\n```cs showLineNumbers\nusing Raylib_cs;\nusing PhysicsSim;\nusing PhysicsSimTester;\n```\n\nInside the ``Main`` function, we'll write the following code:\n```cs showLineNumbers\nprivate static void Main(string[] args) \n        // Initialize Raylib\n        Raylib.InitWindow(800, 800, \"Physics Sim\");\n        Raylib.SetTraceLogLevel(TraceLogLevel.LOG_ALL);\n        Raylib.SetTargetFPS(200);\n        \n        // Core loop\n        while(!Raylib.WindowShouldClose()) {\n            Raylib.BeginDrawing();\n            Raylib.ClearBackground(Color.BLACK);\n            Raylib.DrawCircle(400, 400, 100, Color.WHITE);\n            Raylib.EndDrawing();\n        }\n\n        Raylib.CloseWindow();\n    }\n```\n\nFirst, we open a 800 by 800 window, tell Raylib to log everything and set the framerate to 200. Then we loop until Raylib tells us we should close the window. Every frame, we prepare for drawing, clear the canvas, draw a circle and send out the new frame. If you run this code, you should get something like fig. 1.\n\u0026\u0026\u0026img[images/posts/physics/raylib_helloworld.png](Figure 1) A simple Raylib program.\n\u0026\u0026\u0026\n\nNext we'll add a ``Visualisation`` class. This will be what actually draws things to the screen in the final program.\n```cs showLineNumbers\nusing PhysicsSim;\nusing Raylib_cs;\n\nnamespace PhysicsSimTester\n{\n    public static class Visualization\n    {\n        public static int Res;\n        public static int TextUnits { get =\u003e Res / 100; }\n        public static Font font;\n\n        // Variables used for the debug interface\n        private struct SmoothDebugFloat {\n            private const int cacheMax = 64;\n            private int currentIndex;\n            private float[] cachedValues;\n            private float sum;\n            public float AverageValue { get =\u003e sum / cacheMax; }\n\n            public SmoothDebugFloat() {\n                currentIndex = 0;\n                cachedValues = new float[cacheMax];\n                sum = 0;\n            }\n            public void FeedValue(float value) {\n                sum -= cachedValues[currentIndex];\n                sum += value;\n                cachedValues[currentIndex] = value;\n                currentIndex = (currentIndex + 1) % cacheMax;\n            }\n        }\n        private static SmoothDebugFloat deltaTime;\n\n        \n        public static void Init(int res) {\n            // Set the resolution\n            Res = res;\n\n            // Initialize Raylib\n            Raylib.InitWindow(Res, Res, \"Physics Sim\");\n            Raylib.SetTraceLogLevel(TraceLogLevel.LOG_ALL);\n            Raylib.SetTargetFPS(200);\n            // Load a better font\n            font = Raylib.LoadFontEx(\"times.ttf\", 256, null, 1024);\n\n            deltaTime = new SmoothDebugFloat();\n        }\n\n        public static void DrawAll(params Particle[] objects) {\n            foreach (var obj in objects) {\n                Draw(obj);\n            }\n        }\n        public static void Draw(Particle obj) {\n            \n        }\n\n        public static void DrawDebugInterface(float dt) {\n            // Feed the delta time to the corresponding smooth value\n            deltaTime.FeedValue(dt);\n\n            // Write info to the screen\n            DrawDebugLine($\"{objects.Length} objects @ {(1 / deltaTime.AverageValue).ToString(\"F0\")} FPS\", 2, 2);\n            DrawDebugLine($\"{(dt*1000).ToString(\"F4\")}Δt (in ms)\", 2, 4);\n        }\n        private static void DrawDebugLine(string line, float x, float y) {\n            Raylib.DrawTextEx(font, line, new System.Numerics.Vector2(x * ScreenUnit, y * ScreenUnit),\n                    (int)(2.6 * ScreenUnit), (int)(ScreenUnit / 3), Color.RAYWHITE);\n        }\n        private static void DrawDebugLine(string line, float x, float y, Color color) {\n            Raylib.DrawTextEx(font, line, new System.Numerics.Vector2(x * ScreenUnit, y * ScreenUnit),\n                    (int)(2.6 * ScreenUnit), (int)(ScreenUnit / 3), color);\n        }\n    }\n}\n\n```\n\nThats's a lot, so let's break it down. Firstly, we declare a few variables for convenience. Next we declare the ``SmoothDebugFloat`` struct. This struct holds a list ov previous values of *something* and computes their average. This way, values that change very fast are smoothed. As we need to write more and more debug info, this will become very usefull. For now, we're using it only for delta time. Then we initialize the visualization. We set the resolution, open a window, set the log level (what kind of info Raylib should output to the console), set the desired FPS, load a font ant initialize our delta time. Next, the ``DrawAll`` function receives a list of particles and ``Draw``s each one of them. For now, we don't actually ddraw anything. Finally, we have a function to draw some debug info to the screen.\n\nFor the font loading to work, it is necessary to have a font file in the same folder as the program. To get the file, if you're on Windows, you can go to ``C:\\Windows\\Fonts`` and search for the font family you want (for instance, I chose Times New Roman). Then open it and copy the specific font (I chose the normal one, but you could use bold or italic). Open your project's root folder and navigate to the folder where the ``.exe`` file is, and paste the font file.\n\nNow it's only a matter of calling these functions from ``Main``.\n```cs showLineNumbers\nprivate static void Main(string[] args) \n        // Init the visualization\n        Visualization.Init(800);\n        \n        // Core loop\n        while(!Raylib.WindowShouldClose()) {\n            Raylib.BeginDrawing();\n            Raylib.ClearBackground(Color.BLACK);\n            Visualization.DrawAll();\n            Visualization.DrawDebugInterface(Raylib.GetFrameTime());\n            Raylib.EndDrawing();\n        }\n\n        Raylib.CloseWindow();\n    }\n```\n\nAnd this concludes what we could call the frontend of this app. Before we start implementing the simulation itself, it's necessary to review a lot of maths and physics. So, not to make this post enormous, I'll postpone that for the next post, making this one a shorter one. I'm really excited for this project, and I hopefully so are you. Until the next time, have some fun toying around with Raylib! As a side note, I'd advise you to study some [calculus](https://youtube.com/playlist?list=PLZHQObOWTQDMsr9K-rj53DwVRMYO3t5Yr) and [linear algebra](https://youtube.com/playlist?list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab) while you're waiting for the next post, especially if you don't know much about these topics, because they'll be very important. And finally, you can find the source code for this project (although at a later stage) on [GitHub](https://github.com/levimcgomes/PhysicsSim)."},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"physics_sim0"},"buildId":"38p1H73p411ZP_-sQioo4","assetPrefix":"https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>