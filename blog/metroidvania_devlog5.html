<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#000000"/><meta name="msapplication-TileColor" content="#2b5797"/><meta name="theme-color" content="#ffffff"/><meta name="google-site-verification" content="oliS-hJhDV0wCNFfVhfAC0igKcuVEDSj6XCaqtuSwQA"/><script src="/js/mode.js"></script><title>Metroidvania Devlog 5: State Machine Refactoring and Editor Tool | How I Made A Game</title><meta name="description" content="The state machine system has been refactored and has a fancy new editor"/><script id="giscus-script" src="https://giscus.app/client.js" data-repo="levimcgomes/levimcgomes.github.io" data-repo-id="R_kgDOH_rqaA" data-category="Blog Comments" data-category-id="DIC_kwDOH_rqaM4CVNZX" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="top" data-theme="dark-dimmed" data-lang="en" crossorigin="anonymous" async=""></script><meta name="next-head-count" content="14"/><link rel="preload" href="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/css/3f14950d30926277.css" as="style"/><link rel="stylesheet" href="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/css/3f14950d30926277.css" data-n-g=""/><link rel="preload" href="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/css/28cea9dbbca02b72.css" as="style"/><link rel="stylesheet" href="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/css/28cea9dbbca02b72.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/webpack-74ef5a84c939c88d.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/main-18053c3f67c4d467.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/pages/_app-4862d28c0e85fdc0.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/175675d1-370b5e3106085c09.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/b5f2ed29-b0b5179426d9fdcf.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/chunks/pages/blog/%5Bslug%5D-c43d00c2c6b941b0.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/HR3GWJGZIiy9vVCkr2OZm/_buildManifest.js" defer=""></script><script src="https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages/_next/static/HR3GWJGZIiy9vVCkr2OZm/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4XQ38SS8N1"></script><script src="/js/gtag.js"></script><div class="header-container"><h2 href="/">How I Made A Game</h2><div><a href="/#about">About</a><a href="/archive">All Posts</a><a href="/">Home</a><button class="theme-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="#FFFFFF" style="cursor:pointer;transform:rotate(40deg)"><mask id="myMask2"><rect x="0" y="0" width="100%" height="100%" fill="white"></rect><circle style="cx:12px;cy:4px" r="9" fill="black"></circle></mask><circle cx="12" cy="12" style="r:9px" fill="white" mask="url(#myMask2)"></circle><g stroke="white" style="opacity:0"><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></g></svg></button></div></div><main class="page"><div align="right"><a class="btn-back"><span>Go Back</span></a></div><div class="post-page"><h1 class="post-title">Metroidvania Devlog 5: State Machine Refactoring and Editor Tool</h1><img class="post-full-image" src="../images/posts/metroidvania/devlog5_cover.png" alt=""/><div class="post-date">3/3/2023</div><div class="post-tags"><div class="post-tag">metroidvania</div><div class="post-tag">devlog</div><div class="post-tag">editor-tools</div></div><div class="post-body"><div><p>In <a href="https://levimcgomes.github.io/blog/metroidvania_devlog4">this post</a>, I mentioned I was completely satisfied with the way the state machine system was working. And when you don't like something, you change it, if you can. And in programmer-land, you can always change your code. So I got to work changing the state machine system to something I find better and cleaner. I haven't yet implemented everything, but here's an outline:</p>
<ol>
<li><code>StateMachineComponent</code> is attached to a game object and assigned a <code>StateMachine</code> to work with</li>
<li>The <code>StateMachine</code> is started</li>
<li>Every frame, the <code>StateMachine</code> is ticked
<ol>
<li>The current <code>State</code> is ticked. This is where the <code>State</code> acts and does something.</li>
<li>The current state has a list of <code>Transitions</code> associated with it, its exit transitions.</li>
<li>The <code>StateMachine</code> loops over every one of those transitions and calls its <code>DoTransition</code> method. This method returns a <code>bool</code> and a <code>State</code> (through an <code>out</code> parameter), where <code>true</code> means the transition should be done. All successful <code>Transitions</code> are collected, and then a <code>Transition</code> is selected to be completed by means of a priority index. After a <code>Transition</code> is selected, the <code>StateMachine</code> changes to its returned <code>State</code>. If no <code>Transition</code> is made the <code>StateMachine</code> just remains in the same <code>State</code>.</li>
</ol>
</li>
<li>Every fixed frame, the <code>StateMachine</code> if fixed-ticked. This only fixed-ticks the current state, and doesn't process transitions.</li>
</ol>
<p>Furthermore, every <code>State</code> and <code>Transition</code> has to its availability a set of data from different sources:</p>
<ul>
<li>each <code>StateMachine</code> asset has a <code>ScriptableObject</code> which holds global data.</li>
<li>there's also a lot of runtime data from different sources which can be read, such as the player's data, user input or game state.</li>
</ul>
<p>In my opinion, these reworks make this system much better and cleaner.</p>
<h2>The Editor</h2>
<p>Of course, a StateMachine system needs a good graphical editor. And that's exactly what I made. Using the new UI Toolkit and the UI Builder, as well as experimental <code>GraphView</code> component, I crafted an editor to create and connect states and set the conditions on a <code>Transition</code>.</p>
<p>That's all I have to say for today. This was a shorter post, but making refactorings and an editor isn't much to write home about. I hope next time I can make something a bit longer. 'Til then, goodbye!</p>
</div></div></div><div class="newsletter-post"><form action="https://levimcgomes.pythonanywhere.com/newsletter_signup" method="POST">Subscribe to my newsletter to get notified about new posts!<div class="newsletter-form"><input type="email" name="email_address" placeholder="email address"/><input type="hidden" name="signup_page" value="https://levimcgomes.github.io/blog/metroidvania_devlog5"/><input type="submit" class="btn" value="Sign up"/></div></form></div><div class="giscus"></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Metroidvania Devlog 5: State Machine Refactoring and Editor Tool","date":"3/3/2023","cover_image":"images/posts/metroidvania/devlog5_cover.png","tags":["metroidvania","devlog","editor-tools"],"excerpt":"The state machine system has been refactored and has a fancy new editor"},"slug":"metroidvania_devlog5","content":"\nIn [this post](https://levimcgomes.github.io/blog/metroidvania_devlog4), I mentioned I was completely satisfied with the way the state machine system was working. And when you don't like something, you change it, if you can. And in programmer-land, you can always change your code. So I got to work changing the state machine system to something I find better and cleaner. I haven't yet implemented everything, but here's an outline:\n1. ``StateMachineComponent`` is attached to a game object and assigned a ``StateMachine`` to work with\n1. The ``StateMachine`` is started\n1. Every frame, the ``StateMachine`` is ticked\n    1. The current ``State`` is ticked. This is where the ``State`` acts and does something.\n    1. The current state has a list of ``Transitions`` associated with it, its exit transitions.\n    1. The ``StateMachine`` loops over every one of those transitions and calls its ``DoTransition`` method. This method returns a ``bool`` and a ``State`` (through an ``out`` parameter), where ``true`` means the transition should be done. All successful ``Transitions`` are collected, and then a ``Transition`` is selected to be completed by means of a priority index. After a ``Transition`` is selected, the ``StateMachine`` changes to its returned ``State``. If no ``Transition`` is made the ``StateMachine`` just remains in the same ``State``.\n1. Every fixed frame, the ``StateMachine`` if fixed-ticked. This only fixed-ticks the current state, and doesn't process transitions.\n\nFurthermore, every ``State`` and ``Transition`` has to its availability a set of data from different sources:\n - each ``StateMachine`` asset has a ``ScriptableObject`` which holds global data.\n - there's also a lot of runtime data from different sources which can be read, such as the player's data, user input or game state.\n\n In my opinion, these reworks make this system much better and cleaner.\n ## The Editor\n Of course, a StateMachine system needs a good graphical editor. And that's exactly what I made. Using the new UI Toolkit and the UI Builder, as well as experimental ``GraphView`` component, I crafted an editor to create and connect states and set the conditions on a ``Transition``.\n\n That's all I have to say for today. This was a shorter post, but making refactorings and an editor isn't much to write home about. I hope next time I can make something a bit longer. 'Til then, goodbye!\n"},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"metroidvania_devlog5"},"buildId":"HR3GWJGZIiy9vVCkr2OZm","assetPrefix":"https://cdn.statically.io/gh/levi-gomes/levi-gomes.github.io/gh-pages","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>